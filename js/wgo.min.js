/*! MIT license, more info: wgo.waltheri.net */ (function(e,t){"use strict";var n=document.getElementsByTagName("script");var r=n[n.length-1].src.split("?")[0];var i=r.split("/").slice(0,-1).join("/")+"/";var s={version:"2.0",B:1,W:-1,ERROR_REPORT:true,DIR:i,lang:"en",i18n:{en:{}}};s.opera=navigator.userAgent.search(/(opera)(?:.*version)?[ \/]([\w.]+)/i)!=-1;s.webkit=navigator.userAgent.search(/(webkit)[ \/]([\w.]+)/i)!=-1;s.msie=navigator.userAgent.search(/(msie) ([\w.]+)/i)!=-1;s.mozilla=navigator.userAgent.search(/(mozilla)(?:.*? rv:([\w.]+))?/i)!=-1&&!s.webkit&&!s.msie;s.t=function(e){var t=s.i18n[s.lang][e]||s.i18n.en[e];if(t){for(var n=1;n<arguments.length;n++){t=t.replace("$",arguments[n])}return t}return e};s.extendClass=function(e,t){t.prototype=Object.create(e.prototype);t.prototype.constructor=t;t.prototype.super=e;return t};s.abstractMethod=function(){throw Error("unimplemented abstract method")};s.clone=function(e){if(e&&typeof e=="object"){var t=e.constructor==Array?[]:{};for(var n in e){if(e[n]==e)t[n]=e;else t[n]=s.clone(e[n])}return t}else return e};s.filterHTML=function(e){if(!e||typeof e!="string")return e;return e.replace("<","<").replace(">",">")};var o=function(e,n){var n=n||{};for(var r in n)this[r]=n[r];for(var r in s.Board.default)if(this[r]===t)this[r]=s.Board.default[r];this.tx=this.section.left;this.ty=this.section.top;this.bx=this.size-1-this.section.right;this.by=this.size-1-this.section.bottom;this.init();e.appendChild(this.element);if(this.width&&this.height)this.setDimensions(this.width,this.height);else if(this.width)this.setWidth(this.width);else if(this.height)this.setHeight(this.height)};var u={draw:function(e,t){var n=t.getX(e.x),r=t.getY(e.y),i=t.stoneRadius;this.beginPath();this.fillStyle="rgba(32,32,32,0.5)";this.arc(n-.5,r-.5,i-.5,0,2*Math.PI,true);this.fill()}};var a=function(e,t,n){if(e.obj_arr[t][n][0].c==s.B)return"white";return"black"};var f=function(e,t){var n;e[t].clear();e[t].draw(e);for(var r=0;r<e.size;r++){for(var i=0;i<e.size;i++){for(var s in e.obj_arr[r][i]){if(!e.obj_arr[r][i][s].type)n=e.stoneHandler;else if(typeof e.obj_arr[r][i][s].type=="string")n=o.drawHandlers[e.obj_arr[r][i][s].type];else n=e.obj_arr[r][i][s].type;if(n[t])n[t].draw.call(e[t].context,e.obj_arr[r][i][s],e)}}}for(var s in e.obj_list){var n=e.obj_list[s].handler;if(n[t])n[t].draw.call(e[t].context,e.obj_list[s].args,e)}};o.drawHandlers={NORMAL:{stone:{draw:function(e,t){var n=t.getX(e.x),r=t.getY(e.y),i=t.stoneRadius,o;if(e.c==s.W){o=this.createRadialGradient(n-2*i/5,r-2*i/5,i/3,n-i/5,r-i/5,5*i/5);o.addColorStop(0,"#fff");o.addColorStop(1,"#aaa")}else{o=this.createRadialGradient(n-2*i/5,r-2*i/5,1,n-i/5,r-i/5,4*i/5);o.addColorStop(0,"#666");o.addColorStop(1,"#000")}this.beginPath();this.fillStyle=o;this.arc(n-.5,r-.5,i-.5,0,2*Math.PI,true);this.fill()}},shadow:u},PAINTED:{stone:{draw:function(e,t){var n=t.getX(e.x),r=t.getY(e.y),i=t.stoneRadius,o;if(e.c==s.W){o=this.createRadialGradient(n-2*i/5,r-2*i/5,2,n-i/5,r-i/5,4*i/5);o.addColorStop(0,"#fff");o.addColorStop(1,"#ddd")}else{o=this.createRadialGradient(n-2*i/5,r-2*i/5,1,n-i/5,r-i/5,4*i/5);o.addColorStop(0,"#111");o.addColorStop(1,"#000")}this.beginPath();this.fillStyle=o;this.arc(n-.5,r-.5,i-.5,0,2*Math.PI,true);this.fill();this.beginPath();this.lineWidth=i/6;if(e.c==s.W){this.strokeStyle="#999";this.arc(n+i/8,r+i/8,i/2,0,Math.PI/2,false)}else{this.strokeStyle="#ccc";this.arc(n-i/8,r-i/8,i/2,Math.PI,1.5*Math.PI)}this.stroke()}},shadow:u},GLOW:{stone:{draw:function(e,t){var n=t.getX(e.x),r=t.getY(e.y),i=t.stoneRadius;var o;if(e.c==s.W){o=this.createRadialGradient(n-2*i/5,r-2*i/5,i/3,n-i/5,r-i/5,8*i/5);o.addColorStop(0,"#fff");o.addColorStop(1,"#666")}else{o=this.createRadialGradient(n-2*i/5,r-2*i/5,1,n-i/5,r-i/5,3*i/5);o.addColorStop(0,"#555");o.addColorStop(1,"#000")}this.beginPath();this.fillStyle=o;this.arc(n-.5,r-.5,i-.5,0,2*Math.PI,true);this.fill()}},shadow:u},MONO:{stone:{draw:function(e,t){var n=t.getX(e.x),r=t.getY(e.y),i=t.stoneRadius,o=t.lineWidth||1;if(e.c==s.W)this.fillStyle="white";else this.fillStyle="black";this.beginPath();this.arc(n,r,i-o,0,2*Math.PI,true);this.fill();this.lineWidth=o;this.strokeStyle="black";this.stroke()}}},CR:{stone:{draw:function(e,t){var n=t.getX(e.x),r=t.getY(e.y),i=t.stoneRadius;this.strokeStyle=e.c||a(t,e.x,e.y);this.lineWidth=e.lineWidth||t.lineWidth||1;this.beginPath();this.arc(n-.5,r-.5,i/2,0,2*Math.PI,true);this.stroke()}}},LB:{stone:{draw:function(e,t){var n=t.getX(e.x),r=t.getY(e.y),i=t.stoneRadius,o=e.font||t.font||"";if(t.obj_arr[e.x][e.y][0].c==s.W)this.fillStyle="black";else if(t.obj_arr[e.x][e.y][0].c==s.B)this.fillStyle="white";else this.fillStyle="#1C1C1C";if(e.text.length==1)this.font=Math.round(i*1.5)+"px "+o;else if(e.text.length==2)this.font=Math.round(i*1.2)+"px "+o;else this.font=Math.round(i)+"px "+o;this.beginPath();this.textBaseline="middle";this.textAlign="center";this.fillText(e.text,n,r,2*i)}},grid:{draw:function(e,t){if(!t.obj_arr[e.x][e.y][0].c&&!e._nodraw){var n=t.getX(e.x),r=t.getY(e.y),i=t.stoneRadius;this.clearRect(n-i,r-i,2*i,2*i)}},clear:function(e,t){if(!t.obj_arr[e.x][e.y][0].c){e._nodraw=true;f(t,"grid");delete e._nodraw}}}},SQ:{stone:{draw:function(e,t){var n=t.getX(e.x),r=t.getY(e.y),i=Math.round(t.stoneRadius);this.strokeStyle=e.c||a(t,e.x,e.y);this.lineWidth=e.lineWidth||t.lineWidth||1;this.beginPath();this.rect(Math.round(n-i/2)-.5,Math.round(r-i/2)-.5,i,i);this.stroke()}}},TR:{stone:{draw:function(e,t){var n=t.getX(e.x),r=t.getY(e.y),i=t.stoneRadius;this.strokeStyle=e.c||a(t,e.x,e.y);this.lineWidth=e.lineWidth||t.lineWidth||1;this.beginPath();this.moveTo(n-.5,r-.5-Math.round(i/2));this.lineTo(Math.round(n-i/2)-.5,Math.round(r+i/3)+.5);this.lineTo(Math.round(n+i/2)+.5,Math.round(r+i/3)+.5);this.closePath();this.stroke()}}},MA:{stone:{draw:function(e,t){var n=t.getX(e.x),r=t.getY(e.y),i=t.stoneRadius;this.strokeStyle=e.c||a(t,e.x,e.y);this.lineWidth=(e.lineWidth||t.lineWidth||1)*2;this.beginPath();this.moveTo(Math.round(n-i/2),Math.round(r-i/2));this.lineTo(Math.round(n+i/2),Math.round(r+i/2));this.moveTo(Math.round(n+i/2)-1,Math.round(r-i/2));this.lineTo(Math.round(n-i/2)-1,Math.round(r+i/2));this.stroke()}}},SL:{stone:{draw:function(e,t){var n=t.getX(e.x),r=t.getY(e.y),i=t.stoneRadius;this.fillStyle=e.c||a(t,e.x,e.y);this.beginPath();this.rect(n-i/2,r-i/2,i,i);this.fill()}}},SM:{stone:{draw:function(e,t){var n=t.getX(e.x),r=t.getY(e.y),i=t.stoneRadius;this.strokeStyle=e.c||a(t,e.x,e.y);this.lineWidth=(e.lineWidth||t.lineWidth||1)*2;this.beginPath();this.arc(n-i/3,r-i/3,i/6,0,2*Math.PI,true);this.stroke();this.beginPath();this.arc(n+i/3,r-i/3,i/6,0,2*Math.PI,true);this.stroke();this.beginPath();this.moveTo(n-i/1.5,r);this.bezierCurveTo(n-i/1.5,r+i/2,n+i/1.5,r+i/2,n+i/1.5,r);this.stroke()}}},outline:{stone:{draw:function(e,t){this.globalAlpha=.3;if(e.stoneStyle)o.drawHandlers[e.stoneStyle].stone.draw.call(this,e,t);else t.stoneHandler.stone.draw.call(this,e,t);this.globalAlpha=1}}},mini:{stone:{draw:function(e,t){t.stoneRadius=t.stoneRadius/2;if(e.stoneStyle)o.drawHandlers[e.stoneStyle].stone.draw.call(this,e,t);else t.stoneHandler.stone.draw.call(this,e,t);t.stoneRadius=t.stoneRadius*2}}}};o.CanvasLayer=function(){this.element=document.createElement("canvas");this.context=this.element.getContext("2d")};o.CanvasLayer.prototype={constructor:o.CanvasLayer,setDimensions:function(e,t){this.element.width=e;this.element.height=t},draw:function(e){},clear:function(){this.context.clearRect(0,0,this.element.width,this.element.height)}};o.GridLayer=s.extendClass(o.CanvasLayer,function(){this.super.call(this)});o.GridLayer.prototype.draw=function(e){var t;this.context.beginPath();this.context.lineWidth=1;this.context.strokeStyle="#000";var n=Math.round(e.left),r=Math.round(e.top),i=Math.round(e.fieldWidth*(e.size-1)),s=Math.round(e.fieldHeight*(e.size-1));this.context.strokeRect(n-.5,r-.5,i,s);for(var o=1;o<e.size-1;o++){t=Math.round(e.getX(o))-.5;this.context.moveTo(t,r);this.context.lineTo(t,r+s);t=Math.round(e.getY(o))-.5;this.context.moveTo(n,t);this.context.lineTo(n+i,t)}this.context.stroke();this.context.fillStyle="#000";if(e.starPoints[e.size]){for(var u in e.starPoints[e.size]){this.context.beginPath();this.context.arc(e.getX(e.starPoints[e.size][u].x)-.5,e.getY(e.starPoints[e.size][u].y)-.5,e.starSize*(e.width/300+1),0,2*Math.PI,true);this.context.fill()}}};o.ShadowLayer=s.extendClass(o.CanvasLayer,function(e){this.super.call(this);this.shadowSize=e===t?1:e});o.ShadowLayer.prototype.setDimensions=function(e,t){this.super.prototype.setDimensions.call(this,e,t);this.context.setTransform(1,0,0,1,Math.round(this.shadowSize*e/300),Math.round(this.shadowSize*t/300))};var l=function(e,t){var n=t.getX(e.x),r=t.getY(e.y),i=t.stoneRadius;this.clearRect(n-i-.5,r-i-.5,2*i,2*i);this.clearRect(n-i-.5,r-i-.5,2*i,2*i)};var c=function(){return 3*this.width/(4*(this.bx+1-this.tx)+2)-this.fieldWidth*this.tx};var h=function(){return 3*this.height/(4*(this.by+1-this.ty)+2)-this.fieldHeight*this.ty};var p=function(){return 4*this.width/(4*(this.bx+1-this.tx)+2)};var d=function(){return 4*this.height/(4*(this.by+1-this.ty)+2)};var v=function(e,t){var n;for(var r in this.obj_arr[e][t]){if(!this.obj_arr[e][t][r].type)n=this.stoneHandler;else if(typeof this.obj_arr[e][t][r].type=="string")n=o.drawHandlers[this.obj_arr[e][t][r].type];else n=this.obj_arr[e][t][r].type;for(var i in n){if(n[i].clear)n[i].clear.call(this[i].context,this.obj_arr[e][t][r],this);else l.call(this[i].context,this.obj_arr[e][t][r],this)}}};var m=function(e,t){var n;for(var r in this.obj_arr[e][t]){if(!this.obj_arr[e][t][r].type)n=this.stoneHandler;else if(typeof this.obj_arr[e][t][r].type=="string")n=o.drawHandlers[this.obj_arr[e][t][r].type];else n=this.obj_arr[e][t][r].type;for(var i in n){n[i].draw.call(this[i].context,this.obj_arr[e][t][r],this)}}};var g=function(e){var t=0,n=0,r=this.grid.element,i,s;while(r&&r.tagName!="BODY"){t+=r.offsetTop;n+=r.offsetLeft;r=r.offsetParent}i=Math.round((e.pageX-n-this.left)/this.fieldWidth);s=Math.round((e.pageY-t-this.top)/this.fieldHeight);return{x:i>=this.size?-1:i,y:s>=this.size?-1:s}};var y=function(){this.element.style.width=this.width+"px";this.element.style.height=this.height+"px";this.stoneRadius=this.stoneSize*Math.min(this.fieldWidth,this.fieldHeight)/2;for(var e in this.layers){this.layers[e].setDimensions(this.width,this.height)}};o.prototype={constructor:o,init:function(){this.obj_arr=[];for(var e=0;e<this.size;e++){this.obj_arr[e]=[];for(var t=0;t<this.size;t++)this.obj_arr[e][t]=[]}this.obj_list=[];this.layers=[];this.listeners=[];this.element=document.createElement("div");this.element.className="wgo-board";if(this.background){if(this.background[0]=="#")this.element.style.backgroundColor=this.background;else{this.element.style.backgroundImage="url('"+this.background+"')"}}this.grid=new o.GridLayer;this.shadow=new o.ShadowLayer(this.shadowSize);this.stone=new o.CanvasLayer;this.addLayer(this.grid,100);this.addLayer(this.shadow,200);this.addLayer(this.stone,300)},setWidth:function(e){this.width=e;this.fieldHeight=this.fieldWidth=p.call(this);this.left=c.call(this);this.height=(this.by-this.ty+1.5)*this.fieldHeight;this.top=h.call(this);y.call(this);this.redraw()},setHeight:function(e){this.height=e;this.fieldWidth=this.fieldHeight=d.call(this);this.top=h.call(this);this.width=(this.bx-this.tx+1.5)*this.fieldWidth;this.left=c.call(this);y.call(this);this.redraw()},setDimensions:function(e,t){this.width=e||this.width;this.height=t||this.height;this.fieldWidth=p.call(this);this.fieldHeight=d.call(this);this.left=c.call(this);this.top=h.call(this);y.call(this);this.redraw()},getSection:function(){return this.section},setSection:function(e,t,n,r){if(typeof e=="object"){this.section=e}else{this.section={top:e,right:t,bottom:n,left:r}}this.tx=this.section.left;this.ty=this.section.top;this.bx=this.size-1-this.section.right;this.by=this.size-1-this.section.bottom;this.setDimensions()},setSize:function(e){var e=e||19;if(e!=this.size){this.size=e;this.obj_arr=[];for(var t=0;t<this.size;t++){this.obj_arr[t]=[];for(var n=0;n<this.size;n++)this.obj_arr[t][n]=[]}this.bx=this.size-1-this.section.right;this.by=this.size-1-this.section.bottom;this.setDimensions()}},redraw:function(){this.grid.clear();this.stone.clear();this.shadow.clear();this.grid.draw(this);for(var e=0;e<this.size;e++){for(var t=0;t<this.size;t++){m.call(this,e,t)}}for(var n in this.obj_list){var r=this.obj_list[n].handler;for(var i in r){r[i].draw.call(this[i].context,this.obj_list[n].args,this)}}},getX:function(e){return this.left+e*this.fieldWidth},getY:function(e){return this.top+e*this.fieldHeight},addLayer:function(e,t){e.element.style.position="absolute";e.element.style.zIndex=t;e.setDimensions(this.width,this.height);this.element.appendChild(e.element);this.layers.push(e)},removeLayer:function(e){var t=this.layers.indexOf(e);if(t>=0){this.layers.splice(t,1);this.element.removeChild(e.element)}},update:function(e){if(e.remove&&e.remove=="all")this.removeAllObjects();else if(e.remove){for(var t in e.remove)this.removeObject(e.remove[t])}if(e.add){for(var t in e.add)this.addObject(e.add[t])}},addObject:function(e){if(e.constructor==Array){for(var t in e)this.addObject(e[t]);return}v.call(this,e.x,e.y);for(var t in this.obj_arr[e.x][e.y]){if(this.obj_arr[e.x][e.y][t].type==e.type){this.obj_arr[e.x][e.y][t]=e;m.call(this,e.x,e.y);return}}if(!e.type)this.obj_arr[e.x][e.y].unshift(e);else this.obj_arr[e.x][e.y].push(e);m.call(this,e.x,e.y)},removeObject:function(e){if(e.constructor==Array){for(var n in e)this.removeObject(e[n]);return}var r;for(var i=0;i<this.obj_arr[e.x][e.y].length;i++){if(this.obj_arr[e.x][e.y][i].type==e.type){r=i;break}}if(r===t)return;v.call(this,e.x,e.y);this.obj_arr[e.x][e.y].splice(r,1);m.call(this,e.x,e.y)},removeObjectsAt:function(e,t){if(!this.obj_arr[e][t].length)return;v.call(this,e,t);this.obj_arr[e][t]=[]},removeAllObjects:function(){this.obj_arr=[];for(var e=0;e<this.size;e++){this.obj_arr[e]=[];for(var t=0;t<this.size;t++)this.obj_arr[e][t]=[]}this.redraw()},addCustomObject:function(e,t){this.obj_list.push({handler:e,args:t});this.redraw()},removeCustomObject:function(e,t){for(var n in this.obj_list){if(this.obj_list[n].handler==e&&this.obj_list[n].args==t){delete this.obj_list[n];this.redraw();return true}}return false},addEventListener:function(e,t){var n=this,r={type:e,callback:t,handleEvent:function(e){var r=g.call(n,e);t(r.x,r.y,e)}};this.element.addEventListener(e,r,true);this.listeners.push(r)},removeEventListener:function(e,t){for(var n in this.listeners){if(this.listeners[n].type==e&&this.listeners[n].callback==t){this.element.removeEventListener(this.listeners[n].type,this.listeners[n],true);delete this.listeners[n];return true}}return false},getState:function(){return{objects:s.clone(this.obj_arr),custom:s.clone(this.obj_list)}},restoreState:function(e){this.obj_arr=e.objects||this.obj_arr;this.obj_list=e.custom||this.obj_list;this.redraw()}};o.default={size:19,width:0,height:0,font:"Calibri",lineWidth:1,starPoints:{19:[{x:3,y:3},{x:9,y:3},{x:15,y:3},{x:3,y:9},{x:9,y:9},{x:15,y:9},{x:3,y:15},{x:9,y:15},{x:15,y:15}],13:[{x:3,y:3},{x:9,y:3},{x:3,y:9},{x:9,y:9}],9:[{x:4,y:4}]},stoneHandler:o.drawHandlers.NORMAL,starSize:1,shadowSize:1,stoneSize:1,section:{top:0,right:0,bottom:0,left:0},background:s.DIR+"wood1.jpg"};s.Board=o;var b=function(e){this.size=e;this.schema=[];for(var t=0;t<e*e;t++){this.schema[t]=0}};b.prototype={constructor:s.Position,get:function(e,n){if(e<0||n<0||e>=this.size||n>=this.size)return t;return this.schema[e*this.size+n]},set:function(e,t,n){this.schema[e*this.size+t]=n;return this},clear:function(){for(var e=0;e<this.size*this.size;e++)this.schema[e]=0;return this},clone:function(){var e=new b(this.size);e.schema=this.schema.slice(0);return e}};s.Position=b;var w=function(e,n){this.size=e||19;this.repeating=n===t?"KO":n;this.stack=[];this.stack[0]=new b(e);this.stack[0].capCount={black:0,white:0};this.turn=s.B;Object.defineProperty(this,"position",{get:function(){return this.stack[this.stack.length-1]},set:function(e){this[this.stack.length-1]=e}})};var E=function(e,t,n,r,i){if(n>=0&&n<e.size&&r>=0&&r<e.size&&e.get(n,r)==i){e.set(n,r,0);t.push({x:n,y:r});E(e,t,n,r-1,i);E(e,t,n,r+1,i);E(e,t,n-1,r,i);E(e,t,n+1,r,i)}};var S=function(e,t,n,r,i){if(n<0||n>=e.size||r<0||r>=e.size)return true;if(e.get(n,r)==0)return false;if(t.get(n,r)==true||e.get(n,r)==-i)return true;t.set(n,r,true);return S(e,t,n,r-1,i)&&S(e,t,n,r+1,i)&&S(e,t,n-1,r,i)&&S(e,t,n+1,r,i)};var x=function(e,t,n,r){var i=[];if(t>=0&&t<e.size&&n>=0&&n<e.size&&e.get(t,n)==r){var s=new b(e.size);if(S(e,s,t,n,r)){E(e,i,t,n,r)}}return i};var T=function(e,t,n){var r,i;if(this.repeating=="KO"&&this.stack.length-2>=0)i=this.stack.length-2;else if(this.repeating=="ALL")i=0;else return true;for(var s=this.stack.length-2;s>=i;s--){if(this.stack[s].get(t,n)==e.get(t,n)){r=true;for(var o=0;o<this.size*this.size;o++){if(this.stack[s].schema[o]!=e.schema[o]){r=false;break}}if(r)return false}}return true};w.prototype={constructor:w,getPosition:function(){return this.stack[this.stack.length-1]},play:function(e,t,n,r){if(!this.isOnBoard(e,t))return 1;if(this.position.get(e,t)!=0)return 2;if(!n)n=this.turn;var i=this.position.clone();i.set(e,t,n);var o=x(i,e-1,t,-n).concat(x(i,e+1,t,-n),x(i,e,t-1,-n),x(i,e,t+1,-n));if(!o.length){var u=new b(this.size);if(S(i,u,e,t,n))return 3}if(this.repeating&&!T.call(this,i,e,t)){return 4}if(r)return false;i.color=n;i.capCount={black:this.position.capCount.black,white:this.position.capCount.white};if(n==s.B)i.capCount.black+=o.length;else i.capCount.white+=o.length;this.pushPosition(i);this.turn=-n;return o},pass:function(e){if(e)this.turn=-e;else this.turn=-this.turn;this.pushPosition();this.position.color=-this.position.color},isValid:function(e,t,n){return typeof this.play(e,t,n,true)!="number"},isOnBoard:function(e,t){return e>=0&&t>=0&&e<this.size&&t<this.size},addStone:function(e,t,n){if(this.isOnBoard(e,t)&&this.position.get(e,t)==0){this.position.set(e,t,n||0);return true}return false},removeStone:function(e,t){if(this.isOnBoard(e,t)&&this.position.get(e,t)!=0){this.position.set(e,t,0);return true}return false},setStone:function(e,t,n){if(this.isOnBoard(e,t)){this.position.set(e,t,n||0);return true}return false},getStone:function(e,t){if(this.isOnBoard(e,t)){return this.position.get(e,t)}return 0},pushPosition:function(e){if(!e){var e=this.position.clone();e.capCount={black:this.position.capCount.black,white:this.position.capCount.white};e.color=this.position.color}this.stack.push(e);return this},popPosition:function(){var e=null;if(this.stack.length>0){e=this.stack.pop();if(this.stack.length==0)this.turn=s.B;else if(this.position.color)this.turn=-this.position.color;else this.turn=-this.turn}return e},firstPosition:function(){this.stack=[];this.stack[0]=new b(this.size);this.stack[0].capCount={black:0,white:0};this.turn=s.B;return this},getCaptureCount:function(e){return e==s.B?this.position.capCount.black:this.position.capCount.white},validatePosition:function(){var e,t,n=0,r=0,i=[],o=this.position.clone();for(var u=0;u<this.size;u++){for(var a=0;a<this.size;a++){e=this.position.get(u,a);if(e){t=i.length;i=i.concat(x(o,u-1,a,-e),x(o,u+1,a,-e),x(o,u,a-1,-e),x(o,u,a+1,-e));if(e==s.B)r+=i-t;else n+=i-t}}}this.position.capCount.black+=r;this.position.capCount.white+=n;this.position.schema=o.schema;return i}};s.Game=w;e.WGo=s})(window)